<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Elite Inventory System - Toko Sinar Cahaya Abadi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ["Inter", "sans-serif"] },
            animation: {
              gradient: "gradient 8s linear infinite",
              float: "float 6s ease-in-out infinite",
              "pulse-slow": "pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite",
              "slide-up": "slideUp 0.5s ease-out",
              "slide-down": "slideDown 0.5s ease-out",
              "scale-in": "scaleIn 0.3s ease-out",
              shimmer: "shimmer 2s linear infinite",
            },
            keyframes: {
              gradient: {
                "0%, 100%": { backgroundPosition: "0% 50%" },
                "50%": { backgroundPosition: "100% 50%" },
              },
              float: {
                "0%, 100%": { transform: "translateY(0px)" },
                "50%": { transform: "translateY(-20px)" },
              },
              slideUp: {
                "0%": { transform: "translateY(100px)", opacity: "0" },
                "100%": { transform: "translateY(0)", opacity: "1" },
              },
              slideDown: {
                "0%": { transform: "translateY(-100px)", opacity: "0" },
                "100%": { transform: "translateY(0)", opacity: "1" },
              },
              scaleIn: {
                "0%": { transform: "scale(0.9)", opacity: "0" },
                "100%": { transform: "scale(1)", opacity: "1" },
              },
              shimmer: {
                "0%": { transform: "translateX(-100%)" },
                "100%": { transform: "translateX(100%)" },
              },
            },
          },
        },
      };
    </script>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      }
      .glass-strong {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      .gradient-text {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .hover-lift {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .hover-lift:hover {
        transform: translateY(-12px) scale(1.02);
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
      }
      .btn-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
      }
      .btn-gradient::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: left 0.5s;
      }
      .btn-gradient:hover::before {
        left: 100%;
      }
      .btn-gradient:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
      }
      .stat-card {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.95) 0%,
          rgba(255, 255, 255, 0.85) 100%
        );
        backdrop-filter: blur(20px);
        border: 2px solid rgba(255, 255, 255, 0.5);
      }
      .product-card {
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.6);
        position: relative;
        overflow: hidden;
      }
      .product-card::after {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.4),
          transparent
        );
      }
      .product-card:hover::after {
        animation: shimmer 1.5s;
      }
      .badge-glow {
        box-shadow: 0 0 20px currentColor;
      }
      .input-modern {
        transition: all 0.3s;
        border: 2px solid rgba(102, 126, 234, 0.3);
      }
      .input-modern:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1),
          0 0 20px rgba(102, 126, 234, 0.3);
        transform: scale(1.02);
      }
      .skeleton {
        background: linear-gradient(
          90deg,
          #f0f0f0 25%,
          #e0e0e0 50%,
          #f0f0f0 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
      }
      @keyframes pulse-ring {
        0% {
          box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
        }
        100% {
          box-shadow: 0 0 0 20px rgba(102, 126, 234, 0);
        }
      }
      .pulse-ring {
        animation: pulse-ring 2s infinite;
      }
      .parallax {
        transform: translateZ(0);
        transition: transform 0.1s;
      }
      .neon-text {
        text-shadow: 0 0 10px #667eea, 0 0 20px #667eea, 0 0 30px #667eea;
      }
      .scroll-smooth {
        scroll-behavior: smooth;
      }
    </style>
  </head>
  <body class="font-sans antialiased scroll-smooth">
    <!-- Floating Particles Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
      <div
        class="absolute w-96 h-96 bg-purple-300 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-float"
        style="top: 10%; left: 10%"
      ></div>
      <div
        class="absolute w-96 h-96 bg-blue-300 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-float"
        style="top: 50%; right: 10%; animation-delay: 2s"
      ></div>
      <div
        class="absolute w-96 h-96 bg-pink-300 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-float"
        style="bottom: 10%; left: 50%; animation-delay: 4s"
      ></div>
    </div>

    <!-- Elite Header -->
    <header class="relative z-50 sticky top-0 shadow-2xl">
      <div class="glass-card border-b-2 border-white/20">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex items-center justify-between h-24">
            <div class="flex items-center space-x-6 animate-slide-down">
              <div class="relative">
                <div
                  class="absolute inset-0 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-3xl blur-lg opacity-75 animate-pulse-slow"
                ></div>
                <div
                  class="relative bg-gradient-to-br from-yellow-400 to-orange-500 p-4 rounded-3xl shadow-2xl transform hover:rotate-12 transition-transform duration-300"
                >
                  <svg
                    class="h-12 w-12 text-white"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                    viewBox="0 0 256 256"
                  >
                    <path
                      d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216ZM172.42,72.84l-64,32a8.05,8.05,0,0,0-3.58,3.58l-32,64A8,8,0,0,0,80,184a8.1,8.1,0,0,0,3.58-.84l64-32a8.05,8.05,0,0,0,3.58-3.58l32-64a8,8,0,0,0-10.74-10.74ZM138,138,97.89,158.11,118,118l40.15-20.07Z"
                    ></path>
                  </svg>
                </div>
              </div>
              <div>
                <h1
                  class="text-4xl font-black text-white neon-text tracking-tight"
                >
                  Toko Sinar Cahaya Abadi
                </h1>
                <p
                  class="text-white/90 text-base font-semibold mt-1 flex items-center gap-2"
                >
                  <span
                    class="inline-block w-2 h-2 bg-green-400 rounded-full pulse-ring"
                  ></span>
                  Elite Inventory Management System
                </p>
              </div>
            </div>
            <div class="hidden lg:flex items-center space-x-6">
              <div class="glass-card px-6 py-4 rounded-2xl hover-lift">
                <p
                  class="text-white/80 text-xs font-bold uppercase tracking-wider"
                >
                  Total Produk
                </p>
                <p
                  id="header-total"
                  class="text-4xl font-black text-white mt-1"
                >
                  0
                </p>
              </div>
              <button
                onclick="fetchProducts()"
                class="glass-card px-6 py-4 rounded-2xl hover-lift group"
              >
                <div class="flex items-center gap-3">
                  <div
                    class="bg-white/20 p-2 rounded-xl group-hover:rotate-180 transition-transform duration-500"
                  >
                    <svg
                      class="h-6 w-6 text-white"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="currentColor"
                      viewBox="0 0 256 256"
                    >
                      <path
                        d="M197.67,186.37a8,8,0,0,1,0,11.29l-24,24a8,8,0,0,1-11.31,0l-24-24a8,8,0,0,1,11.31-11.29L160,196.69V128a8,8,0,0,1,16,0v68.69l10.34-10.35A8,8,0,0,1,197.67,186.37ZM91.17,123.17,80,134.34V56a8,8,0,0,0-16,0v78.34L53.17,123.17a8,8,0,1,0-11.31,11.31l24,24a8,8,0,0,0,11.31,0l24-24a8,8,0,0,0-11.31-11.31Z"
                      ></path>
                    </svg>
                  </div>
                  <span class="text-white font-bold">Refresh</span>
                </div>
              </button>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <!-- Elite Statistics Dashboard -->
    <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 animate-slide-up">
        <!-- Total Stock Card -->
        <div
          class="stat-card rounded-3xl p-8 shadow-2xl hover-lift cursor-pointer group"
        >
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-3">
                <div
                  class="bg-gradient-to-br from-blue-500 to-blue-600 p-3 rounded-2xl shadow-lg group-hover:scale-110 transition-transform"
                >
                  <svg
                    class="h-8 w-8 text-white"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                    viewBox="0 0 256 256"
                  >
                    <path
                      d="M223.68,66.15,135.68,18a15.88,15.88,0,0,0-15.36,0l-88,48.17a16,16,0,0,0-8.32,14v95.64a16,16,0,0,0,8.32,14l88,48.17a15.88,15.88,0,0,0,15.36,0l88-48.17a16,16,0,0,0,8.32-14V80.18A16,16,0,0,0,223.68,66.15ZM128,32l80.34,44-29.77,16.3-80.35-44ZM128,120,47.66,76l33.9-18.56,80.34,44ZM40,90l80,43.78v85.79L40,175.82Zm176,85.78h0l-80,43.79V133.82l32-17.51V152a8,8,0,0,0,16,0V107.55L216,90v85.77Z"
                    ></path>
                  </svg>
                </div>
                <div>
                  <p
                    class="text-gray-600 text-sm font-bold uppercase tracking-wider"
                  >
                    Total Stok
                  </p>
                  <p
                    id="total-stock"
                    class="text-5xl font-black gradient-text mt-1"
                  >
                    0
                  </p>
                </div>
              </div>
              <div
                class="h-2 bg-gradient-to-r from-blue-400 to-blue-600 rounded-full shadow-lg"
              ></div>
            </div>
          </div>
        </div>

        <!-- Total Value Card -->
        <div
          class="stat-card rounded-3xl p-8 shadow-2xl hover-lift cursor-pointer group"
        >
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-3">
                <div
                  class="bg-gradient-to-br from-green-500 to-emerald-600 p-3 rounded-2xl shadow-lg group-hover:scale-110 transition-transform"
                >
                  <svg
                    class="h-8 w-8 text-white"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                    viewBox="0 0 256 256"
                  >
                    <path
                      d="M128,88a40,40,0,1,0,40,40A40,40,0,0,0,128,88Zm0,64a24,24,0,1,1,24-24A24,24,0,0,1,128,152ZM240,56H16a8,8,0,0,0-8,8V192a8,8,0,0,0,8,8H240a8,8,0,0,0,8-8V64A8,8,0,0,0,240,56Zm-8,128H24V72H232Z"
                    ></path>
                  </svg>
                </div>
                <div>
                  <p
                    class="text-gray-600 text-sm font-bold uppercase tracking-wider"
                  >
                    Nilai Total
                  </p>
                  <p
                    id="total-value"
                    class="text-5xl font-black gradient-text mt-1"
                  >
                    Rp 0
                  </p>
                </div>
              </div>
              <div
                class="h-2 bg-gradient-to-r from-green-400 to-emerald-600 rounded-full shadow-lg"
              ></div>
            </div>
          </div>
        </div>

        <!-- Low Stock Card -->
        <div
          class="stat-card rounded-3xl p-8 shadow-2xl hover-lift cursor-pointer group"
        >
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-3">
                <div
                  class="bg-gradient-to-br from-orange-500 to-red-600 p-3 rounded-2xl shadow-lg group-hover:scale-110 transition-transform"
                >
                  <svg
                    class="h-8 w-8 text-white"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                    viewBox="0 0 256 256"
                  >
                    <path
                      d="M236.8,188.09,149.35,36.22h0a24.76,24.76,0,0,0-42.7,0L19.2,188.09a23.51,23.51,0,0,0,0,23.72A24.35,24.35,0,0,0,40.55,224h174.9a24.35,24.35,0,0,0,21.33-12.19A23.51,23.51,0,0,0,236.8,188.09ZM120,104a8,8,0,0,1,16,0v40a8,8,0,0,1-16,0Zm8,88a12,12,0,1,1,12-12A12,12,0,0,1,128,192Z"
                    ></path>
                  </svg>
                </div>
                <div>
                  <p
                    class="text-gray-600 text-sm font-bold uppercase tracking-wider"
                  >
                    Stok Menipis
                  </p>
                  <p
                    id="low-stock"
                    class="text-5xl font-black gradient-text mt-1"
                  >
                    0
                  </p>
                </div>
              </div>
              <div
                class="h-2 bg-gradient-to-r from-orange-400 to-red-600 rounded-full shadow-lg"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
      <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
        <!-- Input Form Section -->
        <aside class="xl:col-span-1">
          <div
            class="glass-strong rounded-3xl shadow-2xl overflow-hidden xl:sticky xl:top-36 animate-scale-in"
          >
            <div
              class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 p-8 relative overflow-hidden"
            >
              <div class="absolute inset-0 bg-white/10 backdrop-blur-sm"></div>
              <div class="relative z-10">
                <h2
                  id="form-title"
                  class="text-3xl font-black text-white flex items-center gap-4"
                >
                  <div class="bg-white/20 p-3 rounded-2xl backdrop-blur-sm">
                    <svg
                      class="h-8 w-8"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="currentColor"
                      viewBox="0 0 256 256"
                    >
                      <path
                        d="M208,32H184V24a8,8,0,0,0-16,0v8H88V24a8,8,0,0,0-16,0v8H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32Zm0,176H48V48H72v8a8,8,0,0,0,16,0V48h80v8a8,8,0,0,0,16,0V48h24V208Z"
                      ></path>
                    </svg>
                  </div>
                  <span id="form-title-text">Input Data Barang</span>
                </h2>
                <p class="text-white/80 mt-2 font-medium">
                  Kelola inventaris dengan mudah
                </p>
              </div>
            </div>

            <form id="product-form" class="p-8 space-y-6">
              <input type="hidden" id="product-id" />

              <div class="space-y-2">
                <label
                  for="name"
                  class="block text-sm font-bold text-gray-700 flex items-center gap-2"
                >
                  <span class="text-red-500">●</span> Nama Barang
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  placeholder="Masukkan nama produk..."
                  class="input-modern w-full px-5 py-4 rounded-2xl font-semibold text-gray-900 placeholder-gray-400 bg-white/50"
                />
              </div>

              <div id="image-preview-container" class="hidden space-y-3">
                <label class="block text-sm font-bold text-gray-700"
                  >📸 Foto Saat Ini</label
                >
                <div class="relative group overflow-hidden rounded-2xl">
                  <img
                    id="image-preview"
                    src=""
                    alt="Preview"
                    class="w-full h-56 object-cover"
                  />
                  <div
                    class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-end justify-center pb-6"
                  >
                    <p class="text-white font-bold text-lg">
                      Klik ganti foto untuk mengubah
                    </p>
                  </div>
                </div>
              </div>

              <div class="space-y-2">
                <label
                  for="image"
                  class="block text-sm font-bold text-gray-700"
                >
                  📷 <span id="image-label">Upload Foto Barang</span>
                </label>
                <div class="relative">
                  <input
                    type="file"
                    id="image"
                    name="image"
                    accept="image/png, image/jpeg"
                    class="w-full text-sm file:mr-4 file:py-4 file:px-6 file:rounded-2xl file:border-0 file:font-bold file:bg-gradient-to-r file:from-purple-500 file:to-pink-500 file:text-white hover:file:from-purple-600 hover:file:to-pink-600 file:shadow-xl file:cursor-pointer transition-all border-2 border-dashed border-purple-300 rounded-2xl p-4 bg-purple-50/50"
                  />
                </div>
              </div>

              <div class="space-y-2">
                <label
                  for="description"
                  class="block text-sm font-bold text-gray-700"
                  >📝 Deskripsi</label
                >
                <textarea
                  id="description"
                  name="description"
                  rows="4"
                  placeholder="Tambahkan deskripsi detail produk..."
                  class="input-modern w-full px-5 py-4 rounded-2xl font-medium text-gray-900 placeholder-gray-400 resize-none bg-white/50"
                ></textarea>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div class="space-y-2">
                  <label
                    for="price"
                    class="block text-sm font-bold text-gray-700 flex items-center gap-2"
                  >
                    <span class="text-red-500">●</span> 💰 Harga
                  </label>
                  <input
                    type="number"
                    id="price"
                    name="price"
                    step="100"
                    required
                    placeholder="0"
                    class="input-modern w-full px-5 py-4 rounded-2xl font-bold text-xl text-gray-900 placeholder-gray-400 bg-white/50"
                  />
                </div>
                <div class="space-y-2">
                  <label
                    for="stock"
                    class="block text-sm font-bold text-gray-700 flex items-center gap-2"
                  >
                    <span class="text-red-500">●</span> 📦 Stok
                  </label>
                  <input
                    type="number"
                    id="stock"
                    name="stock"
                    min="0"
                    required
                    placeholder="0"
                    class="input-modern w-full px-5 py-4 rounded-2xl font-bold text-xl text-gray-900 placeholder-gray-400 bg-white/50"
                  />
                </div>
              </div>

              <div class="pt-4 space-y-3">
                <button
                  type="submit"
                  id="btn-submit"
                  class="btn-gradient w-full text-white font-black py-5 px-8 rounded-2xl shadow-2xl text-lg"
                >
                  ✨ Simpan Data
                </button>
                <button
                  type="button"
                  id="btn-cancel"
                  style="display: none"
                  class="w-full bg-gray-200 text-gray-800 font-black py-5 px-8 rounded-2xl hover:bg-gray-300 transition-all shadow-lg text-lg"
                >
                  ❌ Batal
                </button>
              </div>
            </form>
          </div>
        </aside>

        <!-- Product List Section -->
        <section class="xl:col-span-2 space-y-6">
          <div class="glass-strong rounded-3xl p-8 shadow-2xl animate-slide-up">
            <div class="flex items-center justify-between mb-8">
              <h2
                class="text-4xl font-black gradient-text flex items-center gap-4"
              >
                <span
                  class="bg-gradient-to-r from-purple-600 to-pink-600 p-3 rounded-2xl shadow-xl"
                >
                  <svg
                    class="h-10 w-10 text-white"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                    viewBox="0 0 256 256"
                  >
                    <path
                      d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,160H40V56H216V200Z"
                    ></path>
                  </svg>
                </span>
                Daftar Produk Premium
              </h2>
              <div class="text-right">
                <p class="text-gray-600 text-sm font-bold">Menampilkan</p>
                <p id="list-count" class="text-3xl font-black gradient-text">
                  0 Produk
                </p>
              </div>
            </div>

            <div
              id="product-list"
              class="grid grid-cols-1 lg:grid-cols-2 gap-6"
            ></div>
          </div>
        </section>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      const API_URL = "http://localhost:8080/api/products";
      const UPLOADS_URL = "http://localhost:8080/uploads/";
      const form = document.getElementById("product-form");
      const productList = document.getElementById("product-list");
      const productIdInput = document.getElementById("product-id");

      async function fetchProducts() {
        try {
          productList.innerHTML = createSkeletonCards(4);

          const response = await fetch(API_URL);
          const products = await response.json();

          productList.innerHTML = "";

          if (!products || products.length === 0) {
            productList.innerHTML = `
                        <div class="col-span-full">
                            <div class="text-center glass-card rounded-3xl p-20">
                                <div class="animate-float">
                                    <svg class="h-40 w-40 mx-auto text-purple-300 mb-8" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 256 256"><path d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,160H40V56H216V200ZM176,88a16,16,0,1,1-16,16A16,16,0,0,1,176,88Z"></path></svg>
                                </div>
                                <p class="text-gray-600 text-3xl font-black mb-4">Belum Ada Produk</p>
                                <p class="text-gray-500 text-lg">Mulai tambahkan produk pertama Anda sekarang!</p>
                            </div>
                        </div>`;
            updateStats(0, 0, 0, 0);
            return;
          }

          let totalStock = 0,
            totalValue = 0,
            lowStock = 0;

          products.forEach((product, index) => {
            totalStock += product.stock;
            totalValue += product.price * product.stock;
            if (product.stock > 0 && product.stock <= 10) lowStock++;

            const card = createProductCard(product, index);
            productList.appendChild(card);
          });

          updateStats(products.length, totalStock, totalValue, lowStock);
        } catch (error) {
          console.error("Error:", error);
          Swal.fire({
            icon: "error",
            title: "Error Loading Data",
            text: "Failed to fetch products",
            confirmButtonColor: "#667eea",
          });
        }
      }

      function createProductCard(product, index) {
        const card = document.createElement("div");
        card.className =
          "product-card rounded-3xl shadow-xl overflow-hidden hover-lift animate-scale-in";
        card.style.animationDelay = `${index * 0.1}s`;

        const imageUrl = product.image_filename
          ? UPLOADS_URL + product.image_filename
          : "";
        const imageElement = imageUrl
          ? `<img src="${imageUrl}" alt="${product.name}" class="w-full h-64 object-cover">`
          : `<div class="w-full h-64 bg-gradient-to-br from-purple-100 via-pink-100 to-blue-100 flex items-center justify-center">
                    <svg class="w-32 h-32 text-purple-300" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,160H40V56H216V200ZM176,88a16,16,0,1,1-16,16A16,16,0,0,1,176,88Z"></path>
                    </svg>
                </div>`;

        let stockBadge;
        if (product.stock > 10) {
          stockBadge = `<span class="inline-flex items-center gap-2 px-5 py-2 rounded-full text-sm font-black bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg badge-glow">
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 256 256"><path d="M229.66,77.66l-128,128a8,8,0,0,1-11.32,0l-56-56a8,8,0,0,1,11.32-11.32L96,188.69,218.34,66.34a8,8,0,0,1,11.32,11.32Z"></path></svg>
                    Stok Tersedia: ${product.stock}
                </span>`;
        } else if (product.stock > 0) {
          stockBadge = `<span class="inline-flex items-center gap-2 px-5 py-2 rounded-full text-sm font-black bg-gradient-to-r from-yellow-500 to-orange-500 text-white shadow-lg badge-glow animate-pulse">
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 256 256"><path d="M236.8,188.09,149.35,36.22a24.76,24.76,0,0,0-42.7,0L19.2,188.09a23.51,23.51,0,0,0,0,23.72A24.35,24.35,0,0,0,40.55,224h174.9a24.35,24.35,0,0,0,21.33-12.19A23.51,23.51,0,0,0,236.8,188.09ZM120,104a8,8,0,0,1,16,0v40a8,8,0,0,1-16,0Zm8,88a12,12,0,1,1,12-12A12,12,0,0,1,128,192Z"></path></svg>
                    Stok Menipis: ${product.stock}
                </span>`;
        } else {
          stockBadge = `<span class="inline-flex items-center gap-2 px-5 py-2 rounded-full text-sm font-black bg-gradient-to-r from-red-500 to-pink-500 text-white shadow-lg badge-glow">
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 256 256"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path></svg>
                    Stok Habis
                </span>`;
        }

        const escapedDescription = product.description
          ? product.description.replace(/'/g, "\\'")
          : "";

        card.innerHTML = `
                <div class="relative">
                    ${imageElement}
                    <div class="absolute top-4 right-4">
                        ${stockBadge}
                    </div>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <h3 class="text-2xl font-black text-gray-900 mb-2">${
                          product.name
                        }</h3>
                        <div class="flex items-baseline gap-2">
                            <span class="text-4xl font-black gradient-text">Rp ${new Intl.NumberFormat(
                              "id-ID"
                            ).format(product.price)}</span>
                        </div>
                    </div>
                    <p class="text-gray-600 text-sm leading-relaxed line-clamp-2">${
                      product.description || "Tidak ada deskripsi tersedia"
                    }</p>
                    <div class="flex gap-3 pt-2">
                        <button onclick="editProduct(${product.id}, '${
          product.name
        }', '${escapedDescription}', ${product.price}, ${product.stock}, '${
          product.image_filename || ""
        }')"
                            class="flex-1 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-black py-3 px-6 rounded-2xl hover:from-amber-600 hover:to-orange-600 transition-all shadow-lg hover:shadow-2xl transform hover:scale-105">
                            ✏️ Edit
                        </button>
                        <button onclick="deleteProduct(${product.id})"
                            class="flex-1 bg-gradient-to-r from-red-500 to-pink-500 text-white font-black py-3 px-6 rounded-2xl hover:from-red-600 hover:to-pink-600 transition-all shadow-lg hover:shadow-2xl transform hover:scale-105">
                            🗑️ Hapus
                        </button>
                    </div>
                </div>
            `;
        return card;
      }

      function createSkeletonCards(count) {
        let html = "";
        for (let i = 0; i < count; i++) {
          html += `
                    <div class="product-card rounded-3xl shadow-xl overflow-hidden">
                        <div class="skeleton h-64"></div>
                        <div class="p-6 space-y-4">
                            <div class="skeleton h-8 w-3/4 rounded-lg"></div>
                            <div class="skeleton h-10 w-1/2 rounded-lg"></div>
                            <div class="skeleton h-4 w-full rounded-lg"></div>
                            <div class="skeleton h-4 w-2/3 rounded-lg"></div>
                            <div class="flex gap-3 pt-2">
                                <div class="skeleton h-12 flex-1 rounded-2xl"></div>
                                <div class="skeleton h-12 flex-1 rounded-2xl"></div>
                            </div>
                        </div>
                    </div>
                `;
        }
        return html;
      }

      function updateStats(totalProducts, totalStock, totalValue, lowStock) {
        document.getElementById("header-total").textContent = totalProducts;
        document.getElementById("total-stock").textContent =
          totalStock.toLocaleString();
        document.getElementById("total-value").textContent =
          "Rp " + totalValue.toLocaleString("id-ID");
        document.getElementById("low-stock").textContent = lowStock;
        document.getElementById("list-count").textContent =
          totalProducts + " Produk";
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new FormData();
        formData.append("name", document.getElementById("name").value);
        formData.append(
          "description",
          document.getElementById("description").value
        );
        formData.append("price", document.getElementById("price").value);
        formData.append("stock", document.getElementById("stock").value);

        const imageFile = document.getElementById("image").files[0];
        if (imageFile) formData.append("image", imageFile);

        const id = productIdInput.value;
        let url = API_URL;
        let method = "POST";

        if (id) {
          url = `${API_URL}/${id}`;
          method = "PUT";
        }

        try {
          const response = await fetch(url, { method, body: formData });
          if (!response.ok) throw new Error("Failed to save");

          Swal.fire({
            icon: "success",
            title: id
              ? "✅ Data Berhasil Diperbarui!"
              : "🎉 Produk Berhasil Ditambahkan!",
            text: id
              ? "Perubahan telah disimpan"
              : "Produk baru masuk ke inventaris",
            showConfirmButton: false,
            timer: 2000,
            background: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
            color: "#fff",
            customClass: { popup: "animate__animated animate__bounceIn" },
          });

          resetForm();
          fetchProducts();
        } catch (error) {
          Swal.fire({
            icon: "error",
            title: "❌ Gagal Menyimpan",
            text: "Terjadi kesalahan saat menyimpan data",
            confirmButtonColor: "#ef4444",
          });
        }
      });

      function editProduct(id, name, description, price, stock, imageFilename) {
        productIdInput.value = id;
        document.getElementById("name").value = name;
        document.getElementById("description").value = description;
        document.getElementById("price").value = price;
        document.getElementById("stock").value = stock;

        if (imageFilename) {
          document.getElementById("image-preview").src =
            UPLOADS_URL + imageFilename;
          document
            .getElementById("image-preview-container")
            .classList.remove("hidden");
          document.getElementById("image-label").textContent =
            "Ganti Foto Barang";
        }

        document.getElementById("form-title-text").textContent =
          "Edit Data Barang";
        document.getElementById("btn-submit").innerHTML = "💾 Update Data";
        document.getElementById("btn-cancel").style.display = "block";

        window.scrollTo({ top: 0, behavior: "smooth" });

        Swal.fire({
          icon: "info",
          title: "Mode Edit Aktif",
          text: `Mengedit: ${name}`,
          toast: true,
          position: "top-end",
          showConfirmButton: false,
          timer: 3000,
          timerProgressBar: true,
          background: "#667eea",
          color: "#fff",
        });
      }

      async function deleteProduct(id) {
        const result = await Swal.fire({
          title: "🗑️ Hapus Produk?",
          text: "Data yang dihapus tidak dapat dikembalikan!",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#ef4444",
          cancelButtonColor: "#6b7280",
          confirmButtonText: "Ya, Hapus!",
          cancelButtonText: "Batal",
          reverseButtons: true,
          background: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
          color: "#fff",
        });

        if (result.isConfirmed) {
          try {
            const response = await fetch(`${API_URL}/${id}`, {
              method: "DELETE",
            });
            if (!response.ok) throw new Error("Failed to delete");

            Swal.fire({
              icon: "success",
              title: "✅ Terhapus!",
              text: "Produk berhasil dihapus",
              showConfirmButton: false,
              timer: 2000,
              background: "#10b981",
              color: "#fff",
            });
            fetchProducts();
          } catch (error) {
            Swal.fire({
              icon: "error",
              title: "❌ Gagal Menghapus",
              confirmButtonColor: "#ef4444",
            });
          }
        }
      }

      function resetForm() {
        form.reset();
        productIdInput.value = "";
        document
          .getElementById("image-preview-container")
          .classList.add("hidden");
        document.getElementById("image-label").textContent =
          "Upload Foto Barang";
        document.getElementById("form-title-text").textContent =
          "Input Data Barang";
        document.getElementById("btn-submit").innerHTML = "✨ Simpan Data";
        document.getElementById("btn-cancel").style.display = "none";
      }

      document.getElementById("btn-cancel").addEventListener("click", () => {
        Swal.fire({
          icon: "question",
          title: "Batalkan Perubahan?",
          showCancelButton: true,
          confirmButtonText: "Ya, Batalkan",
          cancelButtonText: "Lanjut Edit",
          reverseButtons: true,
          background: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
          color: "#fff",
        }).then((result) => {
          if (result.isConfirmed) {
            resetForm();
            Swal.fire({
              icon: "success",
              title: "Form Direset",
              toast: true,
              position: "top-end",
              showConfirmButton: false,
              timer: 2000,
              background: "#6b7280",
              color: "#fff",
            });
          }
        });
      });

      document.addEventListener("DOMContentLoaded", () => {
        fetchProducts();

        const Toast = Swal.mixin({
          toast: true,
          position: "top-end",
          showConfirmButton: false,
          timer: 3000,
          timerProgressBar: true,
          background: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
          color: "#fff",
        });

        Toast.fire({
          icon: "success",
          title: "✨ Sistem Siap Digunakan!",
        });
      });
    </script>
  </body>
</html>
